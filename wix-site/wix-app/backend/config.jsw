// WIX APP CONFIG: CONFIG.JSW - OPTIMIZED FOR @deepfreediving/kovaldeepai-app
// Centralized configuration for Wix App backend functions
// Version: 4.x - Dynamic versioning for production releases

// üéØ MASTER APPLICATION CONFIGURATION
export const WIX_APP_CONFIG = {
  APP_INFO: {
    name: 'KovalDeepAI',
    version: '4.x',
    appId: '@deepfreediving/kovaldeepai-app',
    environment: 'production'
  },
  
  API_ENDPOINTS: {
    chat: '/chat',
    userMemory: '/userMemory',
    diveLogs: '/diveLogs', 
    memberProfile: '/memberProfile',
    test: '/test',
    wixConnection: '/wixConnection'
  },
  
  EXTERNAL_APIS: {
    openai: 'https://kovaldeepai-main.vercel.app/api/openai/chat',
    pinecone: 'https://kovaldeepai-main.vercel.app/api/pinecone',
    fallbackChat: 'https://kovaldeepai-main.vercel.app/api/chat'
  },
  
  COLLECTIONS: {
    diveLogs: 'DiveLogs',  // ‚úÖ Page collection for all data
    userProfiles: 'Members/FullData'
  },
  
  VALIDATION: {
    maxMessageLength: 4000,
    minMessageLength: 1,
    maxDiveDepth: 400,
    maxDiveTime: 1800,
    validDisciplines: ['STA', 'DYN', 'DNF', 'CWT', 'CNF', 'FIM', 'VWT', 'NLT']
  },
  
  PERFORMANCE: {
    requestTimeout: 15000,
    retryAttempts: 3,
    cacheTimeout: 300000, // 5 minutes
    slowQueryThreshold: 2500
  },
  
  CORS_HEADERS: {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-API-Version',
    'X-Wix-App-ID': '@deepfreediving/kovaldeepai-app'
  }
};

// üî• UTILITY FUNCTIONS
export function createSuccessResponse(data, metadata = {}) {
  return {
    success: true,
    data: data,
    metadata: {
      timestamp: new Date().toISOString(),
      source: 'wix-app-backend',
      version: WIX_APP_CONFIG.APP_INFO.version,
      ...metadata
    }
  };
}

export function createErrorResponse(message, details = null, code = null) {
  return {
    success: false,
    error: message,
    details: details,
    code: code,
    timestamp: new Date().toISOString(),
    source: 'wix-app-backend'
  };
}

export function validateRequest(request, requiredFields = []) {
  const errors = [];
  
  if (!request || !request.body) {
    errors.push('Request body is required');
    return errors;
  }
  
  for (const field of requiredFields) {
    if (!request.body[field]) {
      errors.push(`Missing required field: ${field}`);
    }
  }
  
  return errors;
}

export function logApiCall(endpoint, method, duration, success = true) {
  const logData = {
    endpoint,
    method,
    duration,
    success,
    timestamp: new Date().toISOString()
  };
  
  console.log(`üîç API Call: ${endpoint} ${method} - ${duration}ms - ${success ? '‚úÖ' : '‚ùå'}`, logData);
}

console.log("üîß Wix App Config loaded - Master version");
